[binary_sensor]: https://esphome.io/components/binary_sensor/
[sensor]: https://esphome.io/components/sensor/
[text_sensor]: https://esphome.io/components/text_sensor/
[switch]: https://esphome.io/components/switch/
[number]: https://esphome.io/components/number/
[select]: https://esphome.io/components/select/
[button]: https://esphome.io/components/button/
[climate]: https://esphome.io/components/climate/
[fan]: https://esphome.io/components/fan/

# Конфигурация сущностей ESPHome платформы `tion`

Каждая сущность минимально конфигурируется тремя обязательными
параметрами - платформой `tion`, типом и именем. Пример:
```yaml
  # Платформа
  - platform: tion
    # Тип
    type: entity_type
    # Имя
    name: Entity Name
    # Необязательный параметр, определяется автоматически,
    # необходим при конфигурации нескольких бризеров в одной прошивке.
    # Дальнее всегда будет опущен.
    #tion_id: tion_api
```
Исключение составляют сущности в домене [climate](#домен-climate) и [fan](#домен-fan), для них указание типа отсутствует.

Некоторые сущности могут содерждать дополнительные параметры.

Если не описаны ограничения, то сущность поддерживается для всех моделей бризеров.

Во всех сущностях можно использовать стандартные для их домена переменные и автоматизации,
документация доступна по ссылке в разделе, в названии домена.

> [!IMPORTANT]
> В силу особенностей реализации генерации идентификаторов в ESPHome,
> все имена сущностей должны быть на латинице.
> В дальнейшем вы можете переименовать из в вашей системе УД.

> [!IMPORTANT]
> Если не брать в расчет пакеты, то конкретный домен в конфигурации может быть только один,
> все сущности располагаются внутри него списком.


## Домен [binary_sensor]

Мониторинг состояния параметров бризера в виде бинарного сенсора.

Пример использования:
```yaml
binary_sensor:
  - platform: tion
    type: entity_type
    name: Entity Name
```

### Тип state
Состояние общения с бризером. При отсутсвии ответа более интервала сконфигурированного в `tion.state_timeout`, изменяет свое состояние.

### Тип power
Состояние работы бризира - включен или выключен.

### Тип heater
Состояние обогревателя - включен или выключен.

> [!TIP]
> Алиасы: `heat`

### Тип heating

Состояние работы обогревателя - греет или не греет.

> [!NOTE]
> Для бризеров 4S и Lite - состояние определяется аппаратно.
>
> Для бризеров 3S и O2 - состояние определяется програмно.

### Тип sound

Состояние звуковых оповещений.

> [!TIP]
> Алиасы: `buzzer`

> [!IMPORTANT]
> Поддерживаемые модели: 3S, 4S, Lite.

### Тип led

Состояние световых оповещений.

> [!TIP]
> Алиасы: `light`

> [!IMPORTANT]
> Поддерживаемые модели: 4S, Lite.
>
> Для модели Lite пока не понятна заложенная производителем функция.

### Тип filter

Индикатор состояние ресурса замены фильтров.

### Тип gate_error

Индикатор ошибки закрытия заслонки.

> [!IMPORTANT]
> Поддерживаемые модели: 4S, O2.

### Тип gate

Состояние заслонки.

> [!TIP]
> Алиасы: `gate_state`, `gate_position`, `damper`

### Тип error

Индикатор наличия ошибки бризера.

### Тип boost

Состояние работы турбо-режима `Boost`.


## Домен [sensor]

Мониторинг состояния параметров бризера в виде числового сенсора.

Пример использования:
```yaml
sensor:
  - platform: tion
    type: entity_type
    name: Entity Name
```

### Тип fan_speed
Состояние скорости вентиляции.

> [!TIP]
> Алиасы: `fan`, `speed`

### Тип outdoor_temperature
Состояние датчика внешней температуры.

### Тип current_temperature

Состояние датчика внутренней температуры.

> [!TIP]
> Алиасы: `indoor_temperature`

### Тип target_temperature

Состояние целевой температуры нагрева.

### Тип productivity

Текущая производительность бризера.

### Тип power
Текущаяя потребляемая мощность бризера.

> [!NOTE]
> Вычисляется как сумма `sensor[type=heater_power]` + `sensor[type=fan_power]`

### Тип heater_var

Процент потребления можности работы нагревателя.

> [!IMPORTANT]
> Поддерживаемые модели: 4S, Lite.

### Тип heater_power

Данные о потреблении нагревателя.

> [!NOTE]
> Для бризеров 4S и Lite - состояние определяется аппаратно.
>
> Для бризеров 3S и O2 - при включенном обогреве состояние константа - 1450 Вт.

### Тип fan_power

Данные о петребляемой мощности работы вентилятора.

Используются следующие константы:
#### Tion O2:
 * Дежурный режим: 0.73 Вт
 * 1 скорость: 10.3 Вт
 * 2 скорость: 19.0 Вт
 * 3 скорость: 19.4 Вт
 * 4 скорость: 23.0 Вт
#### Tion 3S:
 * Дежурный режим: 0.73 Вт
 * 1 скорость: 17 Вт
 * 2 скорость: 21 Вт
 * 3 скорость: 26 Вт
 * 4 скорость: 23 Вт
 * 5 скорость: 27 Вт
 * 6 скорость: 29 Вт
#### Tion 4S:
 * Дежурный режим: 0.73 Вт
 * 1 скорость: 15.1 Вт
 * 2 скорость: 16.2 Вт
 * 3 скорость: 23.3 Вт
 * 4 скорость: 23.8 Вт
 * 5 скорость: 25.2 Вт
 * 6 скорость: 30.7 Вт
#### Tion Lite:
 На текущий момент константы показания потребления экивалентны Tion 4S.

> [!NOTE]
> Если у вас есть возможность точно измерить потрребление, я с удовольствием изменю константы и обновлю эту иформацию.

### Тип filter_time_left

Данные об оставшимся времени жизни ресурса фильтра.

### Тип boost_time_left

Оставшееся время работы турбо-режима `Boost`.

### Тип airflow

Данные счетчика прошедшего воздуха в m³.

> [!IMPORTANT]
> Поддерживаемые модели: 4S, Lite.

### Тип work_time

Технические данные об общем времени работы бризера.

> [!IMPORTANT]
> Поддерживаемые модели: 4S, Lite, O2.

### Тип fan_time

Технические данные о времени работы вентилятора.

> [!IMPORTANT]
> Поддерживаемые модели: 4S, Lite.


### Тип airflow_counter

Технические данные внутреннего счетчика прошедшего воздуха.

> [!IMPORTANT]
> Поддерживаемые модели: 4S, Lite.

### Тип pcb_ctl_temperature

Технические данные датчика температуны на плате управления бризера.

> [!IMPORTANT]
> Поддерживаемые модели: 4S.

### Тип pcb_pwr_temperature

Технические данные датчика температуны на плате бризера.

> [!IMPORTANT]
> Поддерживаемые модели: 4S, Lite.



## Домен [text_sensor]

Мониторинг состояния параметров бризера в виде текстового сенсора.

Пример использования:
```yaml
text_sensor:
  - platform: tion
    type: entity_type
    name: Entity Name
```

### Тип errors

Отображает строку с ошибками (EC) и предупреждениями (WS) бризера.

### Тип firmware_version

Отображает текущую версию прошивки бризера.

> [!TIP]
> Алиасы: `firmware`

### Тип hardware_version

Отображает текущую версию железа бризера.

> [!TIP]
> Алиасы: `hardware`


## Домен [switch]

Отображение и изменение состояния бризера переключателем.

Пример использования:
```yaml
switch:
  - platform: tion
    type: entity_type
    name: Entity Name
```

### Тип power

Отображает и изменяет состояние бризера - включен/выключен.

### Тип heater

Отображает и изменяет состояние обогревателя - включен или выключен.

> [!TIP]
> Алиасы: `heat`

### Тип sound

Отображает и изменяет состояние звуковых оповещений.

> [!TIP]
> Алиасы: `buzzer`

> [!IMPORTANT]
> Поддерживаемые модели: 3S, 4S, Lite.

### Тип led

Отображает и изменяет состояние световых оповещений.

> [!TIP]
> Алиасы: `light`

> [!IMPORTANT]
> Поддерживаемые модели: 4S, Lite.
>
> Для модели Lite пока не понятна заложенная производителем функция.

### Тип recirculation

Отображает и переключает состояние заслоники между забором воздуха с улицы или из помещения.

> [!IMPORTANT]
> Поддерживаемые модели: 3S, 4S.

### Тип boost

Отображает и изменяет состояние турбо-режима `Boost`.
Работа этого режима тесно связяна с `tion.update_interval`,
автоматическое завершение возможно только в момент обновления состояния,
на практике это не влияет на использование данной функции т.к. обновление
состояния обычно происхходит не менее раза в миниту.

Дополнительные параметры (все являются необязательными):
 * `duration`, тип uint - задает время работы режима.
 Минимальное значение `1min`, максимальное `60min`, по умолчанию: <отсутствует>.
 * `heater`, тип boolean - задает состояние обогревателя во время работы режима.
 Если не установлен, то будет использовано текущее состояние обогревателя. По умолчанию: <отсутствует>.
 * `temperature`, тип uint - задает целевую температуру нагрева во время работы режима.
 Если не установлен или установлен в 0, то будет использована текущая температура нагрева. По умолчанию: <отсутствует>.

> [!IMPORTANT]
> Параметр `duration` не совместим с параметром `number[type=boost_time]`,
> при использовании совместно поведение определить невозможно.

## Домен [number]

Отображение и изменение состояния параметров бризера в числовом виде.

Пример использования:
```yaml
number:
  - platform: tion
    type: entity_type
    name: Entity Name
```

### Тип fan_speed

Отображает и позволяет изменить скорость вентиляции.

> [!NOTE]
> Скорость вентиляции `0` выключает бризер.

### Тип target_temperature

Отображает и позволяет изменить целевую температуру нагрева.

### Тип boost_time

Отображает и позволяет изменить время работы турбо режима `Boost`.

Дополнительные параметры:
 * `initial_value`, тип [Time](https://esphome.io/guides/configuration-types#config-time) -
 позволяет задать стартовое значение при инициализации
 * `restore_value`, тип boolean - сохранять текущее значение и использовать после перезагрузки

```yaml
 number:
  - platform: tion
    type: boost_time
    name: Boost Time
    initial_value: 20min
    restore_value: true
```

> [!IMPORTANT]
> Тип `boost_time` не совместим с параметром `switch[type=boost].duration`,
> при использовании совместно поведение определить невозможно.

## Домен [select]

Пример использования:
```yaml
select:
  - platform: tion
    type: entity_type
    name: Entity Name
```

### Тип air_intake

Отображает список доступных режимов вентиляции и позволяет выбрать один из них.

> [!TIP]
> Алиасы: `gate_position`

> [!IMPORTANT]
> Поддерживаемые модели: 3S, 4S.

### Тип presets

Отображает список доступных пресетов и позволяет активировать один из них.


## Домен [button]

```yaml
button:
  - platform: tion
    type: entity_type
    name: Entity Name
```

### Тип reset_filter

Производит сброс счетчика ресурса фильтров.

> [!IMPORTANT]
> Поддерживаемые модели: 3S, 4S, Lite.

Дополнительные параметры:
 * `confirm`, тип [switch], защита от случайного нажатия, сброс будет срабатывать,
 только если переключатель включен. По умолчанию: <отсутствует>.

Пример использования:
```yaml
climate:
  - platform: tion
    type: reset_filter
    name: Reset Filter
    confirm:
       name: Reset Filter Confirm
```

## Домен [climate]
Мониторинг и изменение параметров бризера в виде компонента типа климат.

Дополнительные параметры:
 * `enable_heat_cool`, тип boolean - включает/выключает дополнительный режим HEAT_COOL,
 позволяющий ключать бризер, например, через сервис turn_on, с восстановлением
 предыдущего режима обогрева. По умолчанию: False.

Пример использования:
```yaml
climate:
  - platform: tion
    name: Climate
    enable_heat_cool: True
```

## Домен [fan]

Мониторинг и изменение параметров бризера в виде компонента типа вентилятор.

Пример использования:
```yaml
fan:
  - platform: tion
    name: Fan
```
